# 変更履歴

## [3.1.0] - 2025-07-23

### 🆕 新機能
- **📊 使用量分析表示**: 異なる時間集計期間用の`--view`パラメータを追加
  - `--view realtime`（デフォルト）: リアルタイム更新によるライブ監視
  - `--view daily`: 包括的なテーブル形式で集計された日次トークン使用量
  - `--view monthly`: 長期トレンド分析用に集計された月次トークン使用量

### 📝 用途
- **日次分析**: 日次使用パターンを追跡し、ピーク消費期間を特定
- **月次計画**: 長期予算分析とトレンド特定
- **使用量最適化**: より良いリソース計画のための履歴データ分析

## [3.0.0] - 2025-01-13

### 🚨 破壊的変更
- **パッケージ名変更**: `claude-usage-monitor`から`claude-monitor`に変更
  - 新しいインストール: `pip install claude-monitor`または`uv tool install claude-monitor`
  - 新しいコマンドエイリアス: `claude-monitor`と`cmonitor`
- **Python要件**: 最小Pythonバージョンを3.8から3.9に引き上げ
- **アーキテクチャ大改修**: 単一ファイルからモジュラーパッケージ構造への完全な再構築
- **エントリーポイント変更**: モジュール実行は`claude_monitor.__main__:main`経由

### 🏗️ 完全なアーキテクチャ再構築
- **📁 プロフェッショナルパッケージレイアウト**: 適切な名前空間分離による`src/claude_monitor/`構造への移行
  - 単一`claude_monitor.py`ファイルを包括的なモジュラーアーキテクチャに置き換え
  - 8つの専門モジュール間での明確な関心事の分離を実装
- **🔧 モジュラー設計**: 新しいパッケージ構成:
  - `cli/` - コマンドラインインターフェースとブートストラップロジック
  - `core/` - ビジネスロジック、モデル、設定、計算、価格設定
  - `data/` - データ管理、分析、読み取りユーティリティ
  - `monitoring/` - リアルタイムセッション監視とオーケストレーション
  - `ui/` - ユーザーインターフェースコンポーネント、レイアウト、表示コントローラー
  - `terminal/` - ターミナル管理とテーマ処理
  - `utils/` - フォーマット、通知、タイムゾーン、モデルユーティリティ
- **⚡ パフォーマンス向上**: キャッシング、スレッディング、効率的なセッション管理による最適化されたデータ処理

### 🎨 Rich ターミナルUIシステム
- **💫 Rich統合**: プロフェッショナルターミナルインターフェースのためのRichライブラリを使用した完全なUI大改修
  - セマンティックカラーコーディング（🟢🟡🔴）による高度なプログレスバー
  - 適切なターミナル幅処理（80+文字必要）によるレスポンシブレイアウト
  - 強化されたタイポグラフィと視覚的階層
- **🌈 改善されたテーマシステム**: より良いコントラスト比による強化された自動テーマ検出
- **📊 高度な表示コンポーネント**: バーンレートインジケーターと時間ベースメトリクスによる新しい進捗視覚化

### 🔒 タイプセーフティと検証
- **🛡️ Pydantic統合**: 完全なタイプセーフティ実装
  - ユーザーフレンドリーなエラーメッセージによる包括的な設定検証
  - タイプセーフデータモデル（`UsageEntry`、`SessionBlock`、`TokenCounts`）
  - 詳細なフィードバック付きCLIパラメータ検証
- **⚙️ スマート設定**: 最後に使用されたパラメータ永続化によるPydanticベース設定
- **🔍 強化されたエラーハンドリング**: オプションSentry統合による集中エラー管理

### 📈 高度な分析機能
- **🧮 P90パーセンタイル計算**: 機械学習にインスパイアされた使用予測と制限検出
- **📊 スマートプラン検出**: カスタムプランサポート付きClaude制限の自動検出
- **⏱️ リアルタイム監視**: スレッディングとコールバックシステムによる強化されたセッション追跡
- **💡 インテリジェントインサイト**: 高度なバーンレート計算と速度インジケーター

### 🔧 開発者体験の改善
- **🚀 モダンビルドシステム**: HatchlingからSetuptoolsのsrcレイアウトへの移行
- **🧪 包括的テスト**: pytestとカバレッジレポートによるプロフェッショナルテストインフラ
- **📝 強化されたドキュメント**: v3.0.0固有のソリューションによる更新されたトラブルシューティングガイド
- **🔄 CI/CD再活性化**: 復元・強化されたGitHub Actionsワークフロー:
  - マルチPythonバージョンテスト（3.9-3.12）
  - Ruffによる自動リンティング
  - OIDCによる信頼されたPyPI公開
  - 自動バージョンアップと変更履歴管理

### 📦 依存関係とパッケージング更新
- **🆕 追加されたコア依存関係**:
  - `pydantic>=2.0.0`と`pydantic-settings>=2.0.0` - タイプ検証と設定
  - `numpy>=1.21.0` - 高度な計算
  - `sentry-sdk>=1.40.0` - オプションエラートラッキング
  - `pyyaml>=6.0` - 設定ファイルサポート
- **⬆️ 依存関係アップグレード**:
  - `rich`: `>=13.0.0` → `>=13.7.0` - 強化されたUI機能
  - `pytz`: 制約なし → `>=2023.3` - 改善されたタイムゾーン処理
- **🛠️ 開発ツール**: MyPy、Bandit、テストフレームワーク、ドキュメントツールで拡張

### 🎯 強化されたユーザー機能
- **🎛️ 柔軟な設定**: 自動検出、手動オーバーライド、永続設定のサポート
- **🌍 改善されたタイムゾーン処理**: 強化されたタイムゾーン検出と検証
- **⚡ パフォーマンス最適化**: より速い起動時間と削減されたメモリ使用量
- **🔔 スマート通知**: コンテキストメッセージングによる強化されたフィードバックシステム

### 🔧 インストールと互換性
- **📋 インストール方法更新**: `uv`、`pipx`、従来のpipインストールの完全サポート
- **🐧 プラットフォーム互換性**: 外部管理環境を持つ最新Linuxディストリビューションの強化サポート
- **🛣️ 移行パス**: レガシー設定の自動処理とスムーズなアップグレード体験

### 📚 技術実装詳細
- **🏢 プロフェッショナルアーキテクチャ**: 単一責任モジュールによるSOLID原則の実装
- **🔄 非同期対応設計**: リアルタイム監視機能のためのスレッディングインフラ
- **💾 効率的なデータ処理**: エラー耐性による最適化されたJSONL解析
- **🔐 セキュリティ強化**: 安全な設定処理とオプションテレメトリ統合

## [2.0.0] - 2025-06-25

### 追加
- **🎨 スマートテーマシステム**: 最適なターミナル表示のための自動明/暗テーマ検出
  - ターミナル環境、システム設定、背景色に基づくインテリジェントテーマ検出
  - 手動テーマオーバーライドオプション: `--theme light`、`--theme dark`、`--theme auto`
  - テーマ検出のトラブルシューティング用テーマデバッグモード: `--theme-debug`
  - プラットフォーム固有テーマ検出（macOS、Windows、Linux）
  - VSCode統合ターミナル、iTerm2、Windows Terminalのサポート
- **📊 強化されたプログレスバーカラー**: スマートカラーコーディングによる改善された視覚的フィードバック
  - 3段階カラーシステムによるトークン使用プログレスバー:
    - 🟢 緑（0-49%）: 安全な使用レベル
    - 🟡 黄（50-89%）: 警告 - 制限に近づいている
    - 🔴 赤（90-100%）: 危険 - 制限近くまたは制限に達している
  - 一貫した青インジケーターによる時間プログレスバー
  - 絵文字フィードバック（🐌➡️🚀⚡）によるバーンレート速度インジケーター
- **🌈 Richテーマサポート**: 明・暗両方のターミナル用に最適化されたカラースキーム
  - ダークテーマ: 暗い背景用に最適化された明るい色
  - ライトテーマ: 明るい背景用に最適化された暗い色
  - 自動ターミナル機能検出（truecolor、256色、8色）
- **🔧 高度なターミナル検出**: 包括的な環境分析
  - COLORTERM、TERM_PROGRAM、COLORFGBG環境変数サポート
  - OSCエスケープシーケンスを使用したターミナル背景色クエリ
  - クロスプラットフォームシステムテーマ統合

### 変更
- **破壊的**: プログレスバーカラーロジックがセマンティックカラー名（`cost.low`、`cost.medium`、`cost.high`）を使用するように変更
- 異なるターミナル環境間での強化された視覚的一貫性
- 両テーマでのより良いコントラスト比による改善されたアクセシビリティ

### 技術詳細
- テーマ検出とカラー管理による新しい`usage_analyzer/themes/`モジュール
- マルチメソッドテーマ検出アルゴリズムによる`ThemeDetector`クラス
- 自動コンソール設定によるRichテーマ統合
- 最大互換性のための環境認識カラー選択

## [1.0.19] - 2025-06-23

### 修正
- Europe/Warsawタイムゾーンに計算をロックしてタイムゾーン処理を修正
- 信頼性向上のためリセット時刻計算から表示タイムゾーンを分離
- リセット時刻ロジックを簡素化するため動的タイムゾーン入力と関連エラーハンドリングを削除

## [1.0.17] - 2025-06-23

### 追加
- 初期データ読み込み中の「黒い画面」体験を排除するため起動時に即座に表示されるローディング画面
- 初期データ読み込み中のヘッダーと「Claude使用データを取得中...」メッセージによる視覚的フィードバック

## [1.0.16] - 2025-06-23

### 修正
- main()の開始時にカラー変数を初期化してCtrl+C押下時のUnboundLocalErrorを修正
- サブプロセス呼び出しに30秒タイムアウトを追加してccusageコマンドの無限ハングを修正
- より良いデバッグ情報付きの有用なエラーメッセージによる起動時ccusage可用性チェックを追加
- ccusageが失敗した時のより良いデバッグ情報付きエラー表示を改善
- npxがグローバルインストールパッケージを見つけないnpm 7+互換性問題を修正

### 追加
- ハングを防ぐためすべてのccusageサブプロセス呼び出しのタイムアウト処理
- メインループ進入前のccusage可用性の事前フライトチェック
- インストール手順とログイン要件を提案するより有益なエラーメッセージ
- デュアルコマンド実行: 最初に直接`ccusage`コマンドを試行、その後`npx ccusage`にフォールバック
- どの方法（直接またはnpx）が使用されているかの検出と報告

## [1.0.11] - 2025-06-22

### 変更
- `init_dependency.py`をよりシンプルな`check_dependency.py`モジュールに置き換え
- 依存関係チェックを分離された`test_node()`と`test_npx()`関数を使用するようリファクタリング
- 明示的な依存関係チェックを支持して自動Node.jsインストール機能を削除
- 新しい依存関係モジュールを参照するよう`pyproject.toml`のパッケージインクルードを更新

### 修正
- 複雑なインストールロジックを削除して依存関係処理を簡素化
- 不足しているNode.jsまたはnpx依存関係のエラーメッセージを改善

## [1.0.8] - 2025-06-21

### 追加
- 自動Node.jsインストールサポート

## [1.0.7] - 2025-06-21

### 変更
- 改善されたドキュメントとエラーハンドリングによる`init_dependency.py`モジュールを強化
- 利用できない場合の自動`npx`インストールを追加
- 改善されたクロスプラットフォームNode.jsインストールロジック
- 依存関係初期化プロセス全体でより良いエラーメッセージ

## [1.0.6] - 2025-06-21

### 追加
- `pyproject.toml`とhatchlingビルドシステムによるモダンPythonパッケージング
- `init_dependency.py`モジュールによる自動Node.jsインストール
- 入力フラッシングと適切なクリーンアップによるターミナル処理改善
- 自動コード品質チェックのためのGitHub Actionsワークフロー
- Ruffリンターとフォーマッターによるプリコミットフック設定
- 一貫した開発体験のためのVS Code設定
- Claude Code AIアシスタント統合のためのCLAUDE.mdドキュメント
- 推奨インストール方法としての`uv`ツールサポート
- システム全体使用のためのコンソールスクリプトエントリーポイント`claude-monitor`
- Pythonプロジェクト用包括的.gitignore
- プロジェクト履歴追跡のためのCHANGELOG.md

### 変更
- メインスクリプトを`ccusage_monitor.py`から`claude_monitor.py`に名前変更
- より良い互換性のため直接`ccusage`コマンドの代わりに`npx ccusage`を使用
- 監視中の入力破損を防ぐためターミナル処理を改善
- すべてのドキュメントファイル（README、CONTRIBUTING、DEVELOPMENT、TROUBLESHOOTING）を更新
- PyPI パッケージング準備のためプロジェクト構造を強化

### 修正
- 監視中のタイピング時のターミナル入力破損
- カーソル復元による適切なCtrl+C処理
- 終了時のターミナル設定復元

[3.0.0]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v3.0.0
[2.0.0]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v2.0.0
[1.0.19]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.19
[1.0.17]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.17
[1.0.16]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.16
[1.0.11]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.11
[1.0.8]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.8
[1.0.7]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.7
[1.0.6]: https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor/releases/tag/v1.0.6
